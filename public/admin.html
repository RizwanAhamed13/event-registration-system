<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Exo+2:ital,wght@0,100..900;1,100..900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Orbitron:wght@400..900&family=Pacifico&family=Playwrite+IN:wght@100..400&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Press+Start+2P&family=Sixtyfour+Convergence&display=swap" rel="stylesheet">
  <style>

   
    
  
    :root {
     
      --bg-primary: #ffffff;
      --bg-secondary: #f9f9fb;
      --bg-card: #ffffff;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --text-muted: #9ca3af;
      --border-color: #e5e7eb;
      --accent-color: #0070f3;
      --accent-hover: #0051a8;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --glass-bg: rgba(255, 255, 255, 0.8);
      --glass-border: rgba(255, 255, 255, 0.7);
      --backdrop-filter: blur(10px);
    }
    
    
    [data-theme="dark"] {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-card: #1e293b;
      --text-primary: #f3f4f6;
      --text-secondary: #d1d5db;
      --text-muted: #9ca3af;
      --border-color: #334155;
      --accent-color: #3b82f6;
      --accent-hover: #60a5fa;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.25);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.26);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.25);
      --glass-bg: rgba(30, 41, 59, 0.8);
      --glass-border: rgba(30, 41, 59, 0.7);
      --backdrop-filter: blur(10px);
    }
    
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
      font-family: 'Poppins';
    }
    
    body {
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'San Francisco', 'Segoe UI', Roboto, Helvetica, sans-serif;
      font-size: 14px;
      line-height: 1.6;
      color: var(--text-primary);
      background-color: var(--bg-secondary);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }
    
    /* App Container */
    .app-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      max-width: 1440px;
      margin: 0 auto;
      padding: 0 24px;
    }
    
    /* App Header */
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px 0;
    }
    
    .app-header h1 {
      font-weight: 600;
      font-size: 24px;
      letter-spacing: -0.025em;
    }
    
    /* Content Wrapper */
    .content-wrapper {
      flex: 1;
      padding: 24px 0;
    }
    
    /* Content Card (Glass Morphism) */
    .content-card {
      background: var(--glass-bg);
      backdrop-filter: var(--backdrop-filter);
      -webkit-backdrop-filter: var(--backdrop-filter);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow-md);
      margin-bottom: 24px;
    }
    
    /* Top Bar */
    .top-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 24px;
    }
    
    /* Search Container */
    .search-container {
      position: relative;
      flex: 1;
      min-width: 250px;
    }
    
    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
      pointer-events: none;
    }
    
    #search {
      width: 100%;
      padding: 12px 12px 12px 36px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 14px;
      outline: none;
      transition: all 0.2s ease;
    }
    
    #search:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }
    
    #search::placeholder {
      color: var(--text-muted);
    }
    
    /* Filter Container */
    .filter-container {
      min-width: 180px;
    }
    
    select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 14px;
      outline: none;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 12px center;
      background-size: 16px;
      transition: all 0.2s ease;
    }
    
    select:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }
    
    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 12px;
    }
    
    .btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 8px;
      font-weight: 500;
      font-size: 14px;
      transition: all 0.2s ease;
      border: none;
      cursor: pointer;
      outline: none;
      white-space: nowrap;
    }
    
    .btn:focus-visible {
      outline: 2px solid var(--accent-color);
      outline-offset: 2px;
    }
    
    .refresh-btn {
      background-color: var(--bg-primary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }
    
    .refresh-btn:hover {
      background-color: var(--bg-secondary);
    }
    
    .export-btn {
      background-color: var(--accent-color);
      color: white;
    }
    
    .export-btn:hover {
      background-color: var(--accent-hover);
    }
    
    /* Table Styles */
    .table-container {
      position: relative;
      overflow-x: auto;
      margin: 0 -8px;
      padding: 0 8px;
    }
    
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 8px;
    }
    
    th, td {
      padding: 16px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
      vertical-align: middle;
    }
    
    th {
      font-weight: 600;
      color: var(--text-secondary);
      white-space: nowrap;
      user-select: none;
      background: var(--bg-card);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    th span {
      margin-right: 4px;
    }
    
    th i {
      font-size: 12px;
      opacity: 0.6;
    }
    
    th:hover {
      color: var(--accent-color);
      cursor: pointer;
    }
    
    th:first-child {
      border-top-left-radius: 8px;
      border-bottom-left-radius: 8px;
    }
    
    th:last-child {
      border-top-right-radius: 8px;
      border-bottom-right-radius: 8px;
    }
    
    tbody tr {
      background-color: var(--bg-card);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      animation: fadeIn 0.3s ease forwards;
      opacity: 0;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    tbody tr:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
      z-index: 1;
      position: relative;
    }
    
    tbody td:first-child {
      border-top-left-radius: 8px;
      border-bottom-left-radius: 8px;
    }
    
    tbody td:last-child {
      border-top-right-radius: 8px;
      border-bottom-right-radius: 8px;
    }
    
    table input[type="text"],
    table input[type="email"] {
      width: 100%;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid transparent;
      background-color: transparent;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    table input[type="text"]:focus,
    table input[type="email"]:focus {
      border-color: var(--accent-color);
      background-color: var(--bg-primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
      outline: none;
    }
    
    table select {
      width: 100%;
      padding: 8px 28px 8px 12px;
      background-position: right 8px center;
      background-size: 14px;
    }
    
    /* Checkbox Styling */
    table input[type="checkbox"] {
      appearance: none;
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      cursor: pointer;
      position: relative;
      transition: all 0.2s ease;
      background-color: var(--bg-primary);
    }
    
    table input[type="checkbox"]:checked {
      background-color: var(--accent-color);
      border-color: var(--accent-color);
    }
    
    table input[type="checkbox"]:checked::after {
      content: "";
      position: absolute;
      left: 6px;
      top: 2px;
      width: 6px;
      height: 12px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }
    
    table input[type="checkbox"]:focus {
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
      outline: none;
    }
    
    /* Action Buttons in Table */
    table button {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      border: none;
      background-color: var(--bg-primary);
      color: var(--text-secondary);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin: 0 4px;
      transition: all 0.2s ease;
    }
    
    table button:first-of-type {
      color: var(--accent-color);
    }
    
    table button:last-of-type {
      color: var(--danger-color);
    }
    
    table button:hover {
      background-color: var(--bg-secondary);
      transform: translateY(-2px);
    }
    
    /* Loader */
    .loader {
      display: none;
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
    }
    
    .loader-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 3px solid var(--border-color);
      border-top-color: var(--accent-color);
      animation: loader-spin 1s linear infinite;
    }
    
    @keyframes loader-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Footer */
    .app-footer {
      padding: 24px 0;
      text-align: center;
      color: var(--text-muted);
      font-size: 14px;
    }
    
    /* Dark Mode Toggle */
    .mode-toggle {
      position: relative;
    }
    
    .toggle-input {
      opacity: 0;
      position: absolute;
    }
    
    .toggle-label {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 30px;
      background-color: var(--bg-secondary);
      border-radius: 15px;
      cursor: pointer;
      overflow: hidden;
      border: 1px solid var(--border-color);
    }
    
    .toggle-ball {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background-color: var(--accent-color);
      transition: transform 0.3s ease;
      z-index: 2;
    }
    
    .toggle-input:checked + .toggle-label .toggle-ball {
      transform: translateX(30px);
    }
    
    .toggle-label .fas {
      position: absolute;
      top: 7px;
      font-size: 16px;
      transition: opacity 0.3s ease;
      z-index: 1;
    }
    
    .fa-sun {
      right: 10px;
      color: #f59e0b;
      opacity: 1;
    }
    
    .fa-moon {
      left: 10px;
      color: #6366f1;
      opacity: 0;
    }
    
    .toggle-input:checked + .toggle-label .fa-sun {
      opacity: 0;
    }
    
    .toggle-input:checked + .toggle-label .fa-moon {
      opacity: 1;
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--text-muted);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-secondary);
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
      .app-container {
        padding: 0 16px;
      }
    
      .content-card {
        padding: 20px;
      }
    
      th, td {
        padding: 12px;
      }
    }
    
    @media (max-width: 768px) {
      .top-bar {
        flex-direction: column;
      }
    
      .search-container,
      .filter-container,
      .action-buttons {
        width: 100%;
      }
    
      .action-buttons {
        display: grid;
        grid-template-columns: 1fr 1fr;
      }
    
      th, td {
        padding: 10px 8px;
        font-size: 13px;
      }
    
      .table-container {
        margin: 0 -16px;
        padding: 0 16px;
      }
    }
    
    @media (max-width: 640px) {
      .app-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 16px;
      }
    
      .mode-toggle {
        align-self: flex-end;
      }
    
      table {
        display: block;
        overflow-x: auto;
      }
    }
    #particles-js {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: -1;
  }
    </style>
</head>
<body>
    <div class="particles-container" id="particles-js"></div>
  <div class="app-container">
    
    <div class="app-header">
      <h1>Admin Panel</h1>
      <div class="mode-toggle">
        <input type="checkbox" id="theme-toggle" class="toggle-input">
        <label for="theme-toggle" class="toggle-label">
          <i class="fas fa-moon"></i>
          <i class="fas fa-sun"></i>
          <span class="toggle-ball"></span>
        </label>
      </div>
    </div>

    <div class="content-wrapper">
      <div class="content-card">
        <div class="top-bar">
          <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="search" placeholder="Search users..." oninput="loadUsers()">
          </div>
          
          <div class="filter-container">
            <select id="roleFilter" onchange="loadUsers()">
              <option value="">All Roles</option>
              <option value="user">User</option>
              
              <option value="moderator">Moderator</option>
            </select>
          </div>
          <div class="action-buttons">
            <button class="btn refresh-btn" onclick="loadUsers()">
              <i class="fas fa-sync-alt"></i>
              <span>Refresh</span>
            </button>
            <button class="btn export-btn" onclick="exportCSV()">
              <i class="fas fa-file-export"></i>
              <span>Export CSV</span>
            </button>
          </div>
        </div>

        <div class="table-container">
          <table id="user-table">
            <thead>
              <tr>
                <th onclick="sortTable(0)"><span>ID</span> <i class="fas fa-sort"></i></th>
                <th onclick="sortTable(1)"><span>Name</span> <i class="fas fa-sort"></i></th>
                <th onclick="sortTable(2)"><span>Email</span> <i class="fas fa-sort"></i></th>
                <th onclick="sortTable(3)"><span>Roll No</span> <i class="fas fa-sort"></i></th>
                <th onclick="sortTable(4)"><span>Section</span> <i class="fas fa-sort"></i></th>
                <th onclick="sortTable(5)"><span>Department</span> <i class="fas fa-sort"></i></th>
                <th onclick="sortTable(6)"><span>Referral</span> <i class="fas fa-sort"></i></th>
                <th onclick="sortTable(7)"><span>Role</span> <i class="fas fa-sort"></i></th>
                <th onclick="sortTable(8)"><span>Approved</span> <i class="fas fa-sort"></i></th>
                <th><span>Actions</span></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="particles-container" id="particles-js"></div>
          <div class="loader" id="table-loader">
            <div class="loader-circle"></div>
          </div>
        </div>
      </div>
    </div>

    <footer class="app-footer">
    
    </footer>
  </div>
  
  <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

  <script >
    
    particlesJS('particles-js', {
    "particles": {
      "number": {
        "value": 80,
        "density": {
          "enable": true,
          "value_area": 800
        }
      },
      "color": {
        "value": "#0055a4"
      },
      "shape": {
        "type": "circle",
        "stroke": {
          "width": 0,
          "color": "#000000"
        },
        "polygon": {
          "nb_sides": 5
        }
      },
      "opacity": {
        "value": 0.5,
        "random": false,
        "anim": {
          "enable": false,
          "speed": 1,
          "opacity_min": 0.1,
          "sync": false
        }
      },
      "size": {
        "value": 3,
        "random": true,
        "anim": {
          "enable": false,
          "speed": 40,
          "size_min": 0.1,
          "sync": false
        }
      },
      "line_linked": {
        "enable": true,
        "distance": 150,
        "color": "#0055a4",
        "opacity": 0.4,
        "width": 1
      },
      "move": {
        "enable": true,
        "speed": 3,
        "direction": "none",
        "random": false,
        "straight": false,
        "out_mode": "out",
        "bounce": false,
        "attract": {
          "enable": false,
          "rotateX": 600,
          "rotateY": 1200
        }
      }
    },
    "interactivity": {
      "detect_on": "canvas",
      "events": {
        "onhover": {
          "enable": true,
          "mode": "grab"
        },
        "onclick": {
          "enable": true,
          "mode": "push"
        },
        "resize": true
      },
      "modes": {
        "grab": {
          "distance": 140,
          "line_linked": {
            "opacity": 1
          }
        },
        "bubble": {
          "distance": 400,
          "size": 40,
          "duration": 2,
          "opacity": 8,
          "speed": 3
        },
        "repulse": {
          "distance": 200,
          "duration": 0.4
        },
        "push": {
          "particles_nb": 4
        },
        "remove": {
          "particles_nb": 2
        }
      }
    },
    "retina_detect": true
  });
   const baseURL = 'http://localhost:5050/api/admin';
   
   
   document.addEventListener('DOMContentLoaded', () => {
     
     document.getElementById('current-year').textContent = new Date().getFullYear();
   
     
     checkAuth();
   
    
     initTheme();
   
     // Load users data
     loadUsers();
   
     
     setupAnimations();
   });
   
  
   function checkAuth() {
    const user = JSON.parse(localStorage.getItem('user') || '{}');
     if (!user || user.role !== 'admin') {
       
       const appContainer = document.querySelector('.app-container');
       appContainer.innerHTML = `
         <div class="unauthorized-container">
           <div class="unauthorized-icon">
             <i class="fas fa-lock"></i>
           </div>
           <h2>Unauthorized Access</h2>
           <p>You don't have permission to view this page.</p>
           <button class="btn export-btn" onclick="window.location.href='login.html'">Go to Login</button>
         </div>
       `;
   
       const style = document.createElement('style');
       style.textContent = `
         .unauthorized-container {
           display: flex;
           flex-direction: column;
           align-items: center;
           justify-content: center;
           height: 70vh;
           text-align: center;
           gap: 16px;
           animation: fadeIn 0.8s ease;
         }
         .unauthorized-icon {
           font-size: 48px;
           color: var(--text-muted);
           padding: 32px;
           border-radius: 50%;
           background: var(--bg-secondary);
           margin-bottom: 16px;
         }
       `;
       document.head.appendChild(style);
   
      
       throw new Error('Unauthorized access');
     }
   }
   
   function initTheme() {
     const themeToggle = document.getElementById('theme-toggle');
   
     
     const savedTheme = localStorage.getItem('theme');
     const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
   
     if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
       document.body.setAttribute('data-theme', 'dark');
       themeToggle.checked = true;
     }
   
     
     themeToggle.addEventListener('change', () => {
       if (themeToggle.checked) {
         document.body.setAttribute('data-theme', 'dark');
         localStorage.setItem('theme', 'dark');
       } else {
         document.body.removeAttribute('data-theme');
         localStorage.setItem('theme', 'light');
       }
     });
   }
   
   
   async function loadUsers() {
     const token = localStorage.getItem('token');
     if (!token) {
       showToast('Authentication token missing. Please log in again.', 'error');
       window.location.href = 'login.html';
       return;
     }
   
     const loader = document.getElementById('table-loader');
     loader.style.display = 'block';
   
    
     const search = document.getElementById('search').value.toLowerCase();
     const role = document.getElementById('roleFilter').value;
   
     try {
       const res = await fetch(`${baseURL}/users`, {
         headers: { 'Authorization': `Bearer ${token}` }
       });
   
       if (!res.ok) {
         throw new Error(`HTTP error! Status: ${res.status}`);
       }
   
       let users = await res.json();
   
       if (role) {
         users = users.filter(u => u.role === role);
       }
   
       if (search) {
         users = users.filter(u =>
           u.name?.toLowerCase().includes(search) ||
           u.email?.toLowerCase().includes(search) ||
           u.roll_number?.toLowerCase().includes(search) ||
           u.department?.toLowerCase().includes(search)
         );
       }
   
  
       renderUserTable(users);
   
     } catch (error) {
       console.error('Error loading users:', error);
       showToast('Failed to load users data. Please try again.', 'error');
     } finally {
       // Hide loader
       loader.style.display = 'none';
     }
   }
   
   
   function renderUserTable(users) {
     const tbody = document.querySelector('#user-table tbody');
     tbody.innerHTML = '';
   
     if (users.length === 0) {
       tbody.innerHTML = `
         <tr>
           <td colspan="10" style="text-align: center; padding: 40px;">
             <div style="color: var(--text-muted); font-size: 16px;">
               <i class="fas fa-search" style="font-size: 24px; margin-bottom: 8px;"></i>
               <p>No users found</p>
             </div>
           </td>
         </tr>
       `;
       return;
     }
   
     users.forEach((user, index) => {
       const row = document.createElement('tr');
       row.style.animationDelay = `${index * 0.05}s`;
   
       row.innerHTML = `
         <td>${user.id}</td>
         <td><input type="text" value="${user.name || ''}" data-id="${user.id}" data-field="name"></td>
         <td><input type="text" value="${user.email || ''}" data-id="${user.id}" data-field="email"></td>
         <td><input type="text" value="${user.roll_number || ''}" data-id="${user.id}" data-field="roll_number"></td>
         <td><input type="text" value="${user.section || ''}" data-id="${user.id}" data-field="section"></td>
         <td><input type="text" value="${user.department || ''}" data-id="${user.id}" data-field="department"></td>
         <td><input type="text" value="${user.referral_roll_no || ''}" data-id="${user.id}" data-field="referral_roll_no"></td>
         <td>
           <select data-id="${user.id}" data-field="role">
             <option ${user.role === 'user' ? 'selected' : ''} value="user">User</option>
             <option ${user.role === 'admin' ? 'selected' : ''} value="admin">Admin</option>
             <option ${user.role === 'moderator' ? 'selected' : ''} value="moderator">Moderator</option>
           </select>
         </td>
         <td><input type="checkbox" data-id="${user.id}" data-field="is_approved" ${user.is_approved ? 'checked' : ''}></td>
         <td>
           <button title="Save" onclick="saveUser('${user.id}')"><i class="fas fa-save"></i></button>
           <button title="Delete" onclick="deleteUser('${user.id}')"><i class="fas fa-trash-alt"></i></button>
         </td>
       `;
   
       tbody.appendChild(row);
   
       
       setupInputAnimations(row);
     });
   }
  
   function setupInputAnimations(container) {
     
     const inputs = container.querySelectorAll('input[type="text"], select');
     inputs.forEach(input => {
       input.addEventListener('focus', function() {
         this.parentElement.classList.add('input-focused');
       });
   
       input.addEventListener('blur', function() {
         this.parentElement.classList.remove('input-focused');
       });
   
       let originalValue = input.value;
       input.addEventListener('input', function() {
         if (this.value !== originalValue) {
           this.classList.add('input-changed');
         } else {
           this.classList.remove('input-changed');
         }
       });
     });
   
    
     const checkboxes = container.querySelectorAll('input[type="checkbox"]');
     checkboxes.forEach(checkbox => {
       checkbox.addEventListener('change', function() {
         const cell = this.parentElement;
         cell.classList.add('checkbox-changed');
         setTimeout(() => {
           cell.classList.remove('checkbox-changed');
         }, 300);
       });
     });
   }
   
   
   async function saveUser(id) {
     const token = localStorage.getItem('token');
     if (!token) return showToast('Authentication token missing', 'error');
   
    
     showButtonAnimation(id, 'save');
   
    
     const fields = document.querySelectorAll(`[data-id='${id}']`);
     const body = {};
   
     fields.forEach(f => {
       body[f.dataset.field] = f.type === 'checkbox' ? f.checked : f.value;
     });
   
     try {
       const res = await fetch(`${baseURL}/update-user/${id}`, {
         method: 'PUT',
         headers: {
           'Content-Type': 'application/json',
           'Authorization': `Bearer ${token}`
         },
         body: JSON.stringify(body)
       });
   
       if (!res.ok) {
         throw new Error(`HTTP error! Status: ${res.status}`);
       }
   
       const data = await res.json();
       showToast(data.msg || 'User updated successfully', 'success');
   
       
       resetInputChangeState(id);
   
     } catch (error) {
       console.error('Error saving user:', error);
       showToast('Failed to update user. Please try again.', 'error');
     }
   }
   
   
   async function deleteUser(id) {
     const token = localStorage.getItem('token');
     if (!token) return showToast('Authentication token missing', 'error');
   
     
     if (!confirm('Are you sure you want to delete this user?')) return;
   
     
     showButtonAnimation(id, 'delete');
   
     try {
       const res = await fetch(`${baseURL}/delete-user/${id}`, {
         method: 'DELETE',
         headers: { 'Authorization': `Bearer ${token}` }
       });
   
       if (!res.ok) {
         throw new Error(`HTTP error! Status: ${res.status}`);
       }
   
       const data = await res.json();
   
       
       showToast(data.msg || 'User deleted successfully', 'success');
   
     
       loadUsers();
   
     } catch (error) {
       console.error('Error deleting user:', error);
       showToast('Failed to delete user. Please try again.', 'error');
     }
   }
   
   
   function resetInputChangeState(id) {
     const inputs = document.querySelectorAll(`[data-id='${id}']`);
     inputs.forEach(input => {
       input.classList.remove('input-changed');
       if (input.type !== 'checkbox') {
         input.dataset.originalValue = input.value;
       }
     });
   }
   
   
   function showButtonAnimation(id, action) {
     const row = document.querySelector(`[data-id='${id}']`).closest('tr');
     const button = row.querySelector(`button[title="${action === 'save' ? 'Save' : 'Delete'}"]`);
   
     
     button.classList.add('button-action');
     button.innerHTML = action === 'save'
       ? '<i class="fas fa-check"></i>'
       : '<i class="fas fa-times"></i>';
   
    
     setTimeout(() => {
       button.classList.remove('button-action');
       button.innerHTML = action === 'save'
         ? '<i class="fas fa-save"></i>'
         : '<i class="fas fa-trash-alt"></i>';
     }, 1000);
   }
   
   function sortTable(colIndex) {
     const table = document.getElementById('user-table');
     const headers = table.querySelectorAll('th');
   
   
     headers.forEach((header, index) => {
       const icon = header.querySelector('i');
       if (index === colIndex) {
         if (icon.classList.contains('fa-sort') || icon.classList.contains('fa-sort-down')) {
           icon.className = 'fas fa-sort-up';
           header.setAttribute('data-sort', 'asc');
         } else {
           icon.className = 'fas fa-sort-down';
           header.setAttribute('data-sort', 'desc');
         }
       } else {
         icon.className = 'fas fa-sort';
         header.removeAttribute('data-sort');
       }
     });
   

     const sortDir = headers[colIndex].getAttribute('data-sort') === 'asc' ? 1 : -1;
   
     
     const tbody = table.querySelector('tbody');
     const rows = Array.from(tbody.rows);
   
     
     const sortedRows = rows.sort((a, b) => {

       const aValue = getCellValue(a.cells[colIndex]);
       const bValue = getCellValue(b.cells[colIndex]);
   
       
       if (!isNaN(aValue) && !isNaN(bValue)) {
         return (Number(aValue) - Number(bValue)) * sortDir;
       }
       return aValue.localeCompare(bValue) * sortDir;
     });
   
     sortedRows.forEach((row, index) => {
       row.style.animation = 'none';
       tbody.appendChild(row);
   
       void row.offsetWidth;
   
       
       row.style.animation = `fadeIn 0.3s ease forwards ${index * 0.03}s`;
       row.style.opacity = '0';
     });
   }
   
   
   function getCellValue(cell) {
     const input = cell.querySelector('input, select');
     if (input) {
       return input.type === 'checkbox' ? (input.checked ? '1' : '0') : input.value;
     }
     return cell.textContent.trim();
   }
   
  
   function exportCSV() {
    
     const exportBtn = document.querySelector('.export-btn');
     exportBtn.classList.add('button-active');
     setTimeout(() => exportBtn.classList.remove('button-active'), 300);
   
     
     const headers = ['ID', 'Name', 'Email', 'Roll No', 'Section', 'Department', 'Referral', 'Role', 'Approved'];
     const rows = [headers];
   
     
     document.querySelectorAll('#user-table tbody tr').forEach(row => {
       const data = Array.from(row.querySelectorAll('td')).map((cell, index) => {
         
         if (index === 9) return null;
   
         const input = cell.querySelector('input, select');
         if (input) {
           return input.type === 'checkbox' ? (input.checked ? 'Yes' : 'No') : input.value;
         } else {
           return cell.textContent.trim();
         }
       }).filter(val => val !== null); 
   
       rows.push(data);
     });
   
     
     const csv = rows.map(r => r.join(',')).join('\n');
   

     const blob = new Blob([csv], { type: 'text/csv' });
     const url = URL.createObjectURL(blob);
     const filename = `users_export_${new Date().toISOString().split('T')[0]}.csv`;
   
     const a = document.createElement('a');
     a.href = url;
     a.download = filename;
     a.click();
   

     URL.revokeObjectURL(url);
   
     showToast(`Exported ${rows.length - 1} users to CSV`, 'success');
   }
   
  
   function showToast(message, type = 'info') {
     
     let toastContainer = document.querySelector('.toast-container');
     if (!toastContainer) {
       toastContainer = document.createElement('div');
       toastContainer.className = 'toast-container';
       document.body.appendChild(toastContainer);
   
       const style = document.createElement('style');
       style.textContent = `
         .toast-container {
           position: fixed;
           bottom: 24px;
           right: 24px;
           display: flex;
           flex-direction: column;
           gap: 8px;
           z-index: 1000;
         }
         .toast {
           padding: 12px 16px;
           border-radius: 8px;
           background: var(--glass-bg);
           backdrop-filter: var(--backdrop-filter);
           color: var(--text-primary);
           font-weight: 500;
           box-shadow: var(--shadow-md);
           display: flex;
           align-items: center;
           gap: 8px;
           animation: toastIn 0.3s ease, toastOut 0.3s ease 2.7s;
           border: 1px solid var(--border-color);
           max-width: 320px;
         }
         @keyframes toastIn {
           from { transform: translateX(100%); opacity: 0; }
           to { transform: translateX(0); opacity: 1; }
         }
         @keyframes toastOut {
           from { transform: translateX(0); opacity: 1; }
           to { transform: translateX(100%); opacity: 0; }
         }
         .toast.success { border-left: 4px solid var(--success-color); }
         .toast.error { border-left: 4px solid var(--danger-color); }
         .toast.info { border-left: 4px solid var(--accent-color); }
   
         .toast i {
           font-size: 18px;
         }
         .toast.success i { color: var(--success-color); }
         .toast.error i { color: var(--danger-color); }
         .toast.info i { color: var(--accent-color); }
       `;
       document.head.appendChild(style);
     }

     const toast = document.createElement('div');
     toast.className = `toast ${type}`;
   
    
     let icon = 'info-circle';
     if (type === 'success') icon = 'check-circle';
     if (type === 'error') icon = 'exclamation-circle';
   
     toast.innerHTML = `<i class="fas fa-${icon}"></i><span>${message}</span>`;
     toastContainer.appendChild(toast);
   
     
     setTimeout(() => {
       toast.remove();
     }, 3000);
   }
   
   
   function setupAnimations() {
    
     const style = document.createElement('style');
     style.textContent = `
       .input-focused {
         background-color: var(--bg-primary);
         border-radius: 6px;
         box-shadow: 0 0 0 2px var(--accent-color);
       }
       .input-changed {
         border-color: var(--accent-color) !important;
         font-weight: 500;
       }
       .checkbox-changed {
         background-color: rgba(var(--accent-color-rgb), 0.1);
         transition: background-color 0.3s ease;
       }
       .button-action {
         background-color: var(--accent-color) !important;
         color: white !important;
         transform: scale(1.1) !important;
       }
       .button-active {
         transform: scale(0.95);
       }
   
       /* Convert accent color to RGB for opacity control */
       :root {
         --accent-color-rgb: 0, 112, 243;
       }
       [data-theme="dark"] {
         --accent-color-rgb: 59, 130, 246;
       }
     `;
     document.head.appendChild(style);
   }
   </script>
</body>
</html>
